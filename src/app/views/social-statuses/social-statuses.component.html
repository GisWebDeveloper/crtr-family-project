<c-container breakpoint="lg" class="h-auto">

    <!-- FILTER -->
    <c-card class="mb-4" [cBorder]="'secondary'">
        <c-card-header>
            <span class="pe-2"><svg cIcon name="cilFilter"></svg></span>
            <strong>{{ 'filter' | translate }}</strong>
            <span class="float-end">
                <a role="button" class="btn btn-sm p-0" (click)="toggleCollapse(0)">
                    <i class="fa fa-2x" [ngClass]="{'fa-angle-down': !visible[0], 'fa-angle-up': visible[0]}"></i>
                </a>
            </span>
        </c-card-header>
        <c-card-body *ngIf="visible[0]">
            <form cForm (submit)="search()" novalidate>
                <c-row class="mb-3">
                    <c-col [md]="10">
                        <ng-select id="status" name="status" bindValue="id" bindLabel="nameRu"
                                   [items]="statusDictionaryList" [(ngModel)]="filterStatusId" [clearable]="true">
                            <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
                                <div>{{ item.code + ' - ' + (translateService.currentLang == 'kz' ? item.nameKz : item.nameRu) }}</div>
                            </ng-template>
                        </ng-select>
                    </c-col>
                    <c-col [md]="2">
                        <div class="d-flex flex-column">
                            <button cButton color="info" type="submit" class="text-white">
                                <span class="pe-2"><svg cIcon name="cilSearch"></svg></span>
                                {{ 'search' | translate }}
                            </button>
                        </div>
                    </c-col>
                </c-row>
            </form>
        </c-card-body>
    </c-card>

    <!-- STATUS STAT LIST -->
    <c-card class="mb-4 status-stat-list-card" [cBorder]="'secondary'">
        <c-card-header>
            <span class="pe-2"><svg cIcon name="cilCalculator"></svg></span>
            <strong>{{ 'menu.social-statuses' | translate }}</strong>
            <span class="float-end">
                <a role="button" class="btn btn-sm p-0" (click)="toggleCollapse(1)">
                    <i class="fa fa-2x" [ngClass]="{'fa-angle-down': !visible[1], 'fa-angle-up': visible[1]}"></i>
                </a>
            </span>
        </c-card-header>
        <c-card-body *ngIf="visible[1]">
            <div class="status-stat-list">
                <!-- Header -->
                <div class="status-stat-header">
                    <div class="status-stat-header-item">
                        <span class="header-label">{{ 'stat-page.category' | translate }}</span>
                    </div>
                    <div class="status-stat-header-item">
                        <span class="header-label">{{ 'member' | translate }}</span>
                    </div>
                </div>

                <!-- Divider -->
                <div class="status-stat-divider"></div>

                <!-- Status Items -->
                <div class="scroll-body" style="max-height: 50vh; overflow-x: hidden !important;">
                    <ng-container *ngFor="let stItem of statusList; let idx = index">
                        <div class="status-stat-item"
                             [ngClass]="{ 'status-stat-item--active': !params.categoryId && params.statusId && params.statusId == stItem.statusId,
                                         'status-stat-item--clickable': hasPermission(permissions.SOC_STATUS_LIST) }"
                             (click)="hasPermission(permissions.SOC_STATUS_LIST) ? selectStatusItem(stItem.statusId, stItem.categoryId, stItem.nameRu) : null">
                            <div class="status-stat-item-content">
                                <span class="status-stat-number">{{ (idx + 1) + '.' }}</span>
                                <span class="status-stat-name">{{ stItem | translateProp }}</span>
                            </div>
                            <div class="status-stat-count">{{ utilService.numberFormat(stItem.cnt) }}</div>
                        </div>
                        <div class="status-stat-divider" *ngIf="idx < statusList.length - 1 || categoryList.length > 0"></div>
                    </ng-container>

                    <!-- Category Items -->
                    <ng-container *ngFor="let catItem of categoryList; let idx = index">
                        <div class="status-stat-item"
                             [ngClass]="{ 'status-stat-item--active': params.categoryId && params.categoryId == catItem.categoryId,
                                         'status-stat-item--clickable': hasPermission(permissions.SOC_STATUS_LIST) }"
                             (click)="hasPermission(permissions.SOC_STATUS_LIST) ? selectStatusItem(catItem.statusId, catItem.categoryId, catItem.nameRu) : null">
                            <div class="status-stat-item-content">
                                <span class="status-stat-number">{{ statusList.length + '.' + (idx + 1) }}</span>
                                <span class="status-stat-name">{{ translateService.currentLang === 'kz' ? catItem.nameKz : catItem.nameRu }}</span>
                            </div>
                            <div class="status-stat-count">{{ utilService.numberFormat(catItem.cnt) }}</div>
                        </div>
                        <div class="status-stat-divider" *ngIf="idx < categoryList.length - 1"></div>
                    </ng-container>
                </div>

                <c-alert color="warning"
                         *ngIf="categoryList.length == 0 && statusList.length == 0 && filterStatusId">
                    {{ 'warnings.no-data-found' | translate }}
                </c-alert>
            </div>
        </c-card-body>
    </c-card>

</c-container>

<!-- PERSON LIST -->
<c-card class="mb-4" [cBorder]="'secondary'" *ngIf="params.statusId || params.categoryId">
    <c-card-header>
        <span class="pe-2"><svg cIcon name="cilJustifyLeft"></svg></span>
        <strong>{{ 'lists' | translate }}</strong>
        <span class="float-end">
            <a role="button" class="btn btn-sm p-0 ms-2" (click)="toggleCollapse(2)">
                <i class="fa fa-2x" [ngClass]="{'fa-angle-down': !visible[2], 'fa-angle-up': visible[2]}"></i>
            </a>
        </span>
        <span class="float-end">
            <span>Скачать</span>
            <button cButton color="success" variant="ghost" size="sm" (click)="downloadReport()">
                <i class="fa fa-file-excel-o"></i></button>
        </span>
    </c-card-header>
    <c-card-body *ngIf="visible[2]">
        <c-callout color="info">{{ params.name }}</c-callout>
        <table cTable striped hover *ngIf="params.list.length > 0">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">{{ 'need-actions-page.region' | translate }}</th>
                <th scope="col">{{ 'need-actions-page.full-name' | translate }}</th>
                <th scope="col">{{ 'need-actions-page.address' | translate }}</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let item of params.list; let idx = index">
                <th scope="row">{{ ((params.pagination.currentPage - 1) * params.pagination.itemsPerPage) + idx + 1 }}</th>
                <td>{{ item.stateName + ', ' + item.regionName }}</td>
                <td>
                    <a target="_blank" class="link-info" [routerLink]="['/family/' + item.iin]"
                       (click)="utilService.navigateToFamilyPortrait(item.iin)">
                        {{ utilService.concat(' / ', item.iin, item.fullName) }}
                    </a>
                </td>
                <td>{{ item.address }}</td>
            </tr>
            </tbody>
        </table>

        <c-alert color="warning" *ngIf="params.list.length == 0">
            {{ 'warnings.no-data-found' | translate }}
        </c-alert>
    </c-card-body>
    <c-card-footer>
        <c-row>
            <c-col [md]="10">
                <pagination class="pagination-sm mb-0"
                            *ngIf="params.pagination.totalItems > params.pagination.itemsPerPage"
                            [(ngModel)]="params.pagination.currentPage" [itemsPerPage]="params.pagination.itemsPerPage"
                            [totalItems]="params.pagination.totalItems" [maxSize]="params.pagination.maxSize"
                            [boundaryLinks]="true" (pageChanged)="changePage($event.page)"
                            previousText="&lsaquo;" nextText="&rsaquo;" firstText="&laquo;"
                            lastText="&raquo;"></pagination>
            </c-col>
            <c-col [md]="2">
                <div class="text-lowercase float-end">
                    <small>{{ 'item-count' | translate }}:
                        {{ utilService.numberFormat(params.pagination.totalItems) }}</small>
                </div>
            </c-col>
        </c-row>
    </c-card-footer>
</c-card>

